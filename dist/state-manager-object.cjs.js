"use strict";var t=require("basekits"),e=require("event-emitter-object");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=r(t),a=r(e),n=i.default.typekit,o=i.default.objectkit,u=i.default.validationkit;var f={create:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!n.isObject(t))throw new Error("Invalid initial state.");var e=a.default.create(),r={state:t,prevState:null};function i(t){if(!n.isObject(t))throw new Error("Invalid payload.");var i=v(),a=Object.assign({},i,t);u.isEqual(i,a)||(r.state=a,r.prevState=i,e.emit("update",[r.state,r.prevState]))}function f(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i="string"==typeof t?t:void 0,a=void 0===i?t:r;if("function"!=typeof a)throw new Error("Subscriber function should be a type of function.");e.on("update",(function(t,e){var r=i?o.getProp(t,i):t,n=i?o.getProp(e,i):e;u.isEqual(r,n)||a(r,n)}))}function v(){return r.state}function c(){return r.prevState}return{getState:v,getPrevState:c,updateState:i,subscribe:f}}};module.exports=f;
