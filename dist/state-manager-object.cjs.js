"use strict";var t=require("basekits"),e=require("event-emitter-object");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=a(t),i=a(e),n=r.default.typekit,u=r.default.objectkit,o=r.default.validationkit;var s={create:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!n.isObject(t))throw new Error("Invalid initial state.");var e=i.default.create(),a={state:t,prevState:null};function r(t){if(!n.isObject(t))throw new Error("Invalid payload.");var r=v(),i=Object.assign({},r,t);o.isEqual(r,i)||(a.state=i,a.prevState=r,e.emit("update",[a.state,a.prevState]))}function s(t,a){e.on("update",(function(e,r){var i=u.getProp(e,t),o=u.getProp(r,t);n.isEqual(i,o)||a(i,o)}))}function v(){return a.state}function c(){return a.prevState}return{getState:v,getPrevState:c,updateState:r,subscribe:s}}};module.exports=s;
