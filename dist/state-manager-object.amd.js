define(["basekits","event-emitter-object"],(function(t,e){"use strict";function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=a(t),i=a(e),n=r.default.typekit,u=r.default.objectkit,o=r.default.validationkit;return{create:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!n.isObject(t))throw new Error("Invalid initial state.");var e=i.default.create(),a={state:t,prevState:null};function r(t){if(!n.isObject(t))throw new Error("Invalid payload.");var r=f(),i=Object.assign({},r,t);o.isEqual(r,i)||(a.state=i,a.prevState=r,e.emit("update",[a.state,a.prevState]))}function c(t,a){e.on("update",(function(e,r){var i=u.getProp(e,t),o=u.getProp(r,t);n.isEqual(i,o)||a(i,o)}))}function f(){return a.state}function s(){return a.prevState}return{getState:f,getPrevState:s,updateState:r,subscribe:c}}}}));
